@model IEnumerable<MuniConnect.Models.ServiceRequest>

<div class="container mt-4">
    <h2 class="text-center mb-3">Search Request</h2>

    @if (!Model.Any())
    {
        <div class="alert alert-danger text-center">
            <i class="bi bi-exclamation-circle"></i> Request not found.
        </div>
    }
    else
    {
        foreach (var req in Model)
        {
            <div class="card shadow p-3 mb-3">
                <h4>@req.Title</h4>
                <p><strong>ID:</strong> @req.RequestId</p>
                <p><strong>Department:</strong> @req.Department</p>
                <p><strong>Description:</strong> @req.Description</p>
                <p>
                    <strong>Status:</strong>
                    <span class="badge status-badge bg-@req.Status.Replace(" ", "").ToLower()">@req.Status</span>
                </p>
            </div>
        }
    }
</div>

<style>
    /* Base badge styles */
    .status-badge {
        padding: 0.35em 0.65em;
        font-size: 0.75em;
        font-weight: 700;
        line-height: 1;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: 0.375rem;
    }

    /* Your existing color classes */
    .bg-pending {
        background-color: #ffc107 !important;
        color: #212529 !important;
    }

    .bg-inprogress {
        background-color: #51c39d !important;
        color: white !important;
    }

    .bg-completed {
        background-color: #198754 !important;
        color: white !important;
    }

    /* Add these for other possible statuses */
    .bg-resolved {
        background-color: #198754 !important;
        color: white !important;
    }

    .bg-cancelled {
        background-color: #dc3545 !important;
        color: white !important;
    }

    .bg-closed {
        background-color: #6c757d !important;
        color: white !important;
    }

    /* Fallback for any unknown status */
    .status-badge:not([class*="bg-"]) {
        background-color: #6c757d !important;
        color: white !important;
    }

    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        console.log("ServiceRequest.js loaded");

        // Your existing JS code for search form and BFS...
        const searchForm = document.querySelector("#searchForm");
        if (searchForm) {
            searchForm.addEventListener("submit", function (e) {
                e.preventDefault();
                const id = document.querySelector("#searchInput").value.trim();
                if (id === "") {
                    alert("Please enter a request ID");
                    return;
                }
                window.location.href = `/ServiceRequest/TrackProgress?requestId=${id}`;
            });
        }

        // Status animation
        const statusBadges = document.querySelectorAll(".status-badge");
        statusBadges.forEach(badge => {
            badge.classList.add("fade-in");

            // Debug logging
            console.log("Status badge:", {
                text: badge.textContent,
                classes: badge.className,
                computedStyle: window.getComputedStyle(badge).backgroundColor
            });
        });
    });
</script>